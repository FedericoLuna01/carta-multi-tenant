"use strict";(()=>{var e={};e.id=1051,e.ids=[1051],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},51762:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>q,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>E,staticGenerationAsyncStorage:()=>x});var t={};s.r(t),s.d(t,{DELETE:()=>p,GET:()=>m,OPTIONS:()=>g,PATCH:()=>c});var a=s(14609),n=s(15459),i=s(87411),o=s(57771),l=s(61821),u=s(9142),d=s(38888);async function m(e,{params:r}){let s=e.headers.get("origin"),t=s&&(s.endsWith(".carta.ar")||s.includes("localhost")||"https://carta.ar"===s),{slug:a,orderId:n}=r;if(!a)return new d.NextResponse("Missing slug",{status:400});if(!n)return new d.NextResponse("Missing order id",{status:400});let i=await (0,u.VG)(a);try{let e=await l.Z.order.findUnique({where:{id:Number(n),userId:i.id},include:{products:{include:{extras:!0,size:!0,product:!0}}}});return d.NextResponse.json(e,{headers:{"Access-Control-Allow-Origin":t?s:"","Access-Control-Allow-Credentials":"true"}})}catch(e){return console.log("[ORDER_GET]",e),new d.NextResponse("Something went wrong",{status:500})}}async function c(e,{params:r}){let{slug:s,orderId:t}=r,{status:a,paymentStatus:n}=await e.json();if(!t)return new d.NextResponse("Missing order id",{status:400});let i=await (0,o.I8)();if(!await (0,u.Ne)(s,i))return new d.NextResponse("Unauthorized",{status:401});try{let e=await l.Z.order.update({where:{id:Number(t),userId:i.user.id},data:{status:a,paymentStatus:n}});return d.NextResponse.json(e)}catch(e){return console.log("[ORDER_PATCH]",e),new d.NextResponse("Something went wrong",{status:500})}}async function p(e,{params:r}){let{slug:s,orderId:t}=r,a=await (0,o.I8)();if(!await (0,u.Ne)(s,a))return new d.NextResponse("Unauthorized",{status:401});if(!s)return new d.NextResponse("Missing slug",{status:400});if(!t)return new d.NextResponse("Missing order id",{status:400});try{let e=await l.Z.order.delete({where:{id:Number(t),userId:a.user.id}});return d.NextResponse.json(e)}catch(e){return console.log("[ORDER_DELETE]",e),new d.NextResponse("Something went wrong",{status:500})}}async function g(e){let r=e.headers.get("origin"),s=r&&(r.endsWith(".carta.ar")||r.includes("localhost")||"https://carta.ar"===r);return new d.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":s?r:"","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}let w=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/[slug]/orders/[orderId]/route",pathname:"/api/[slug]/orders/[orderId]",filename:"route",bundlePath:"app/api/[slug]/orders/[orderId]/route"},resolvedPagePath:"D:\\Workspace\\carta-multi-tenant\\apps\\web\\app\\api\\[slug]\\orders\\[orderId]\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:E}=w,q="/api/[slug]/orders/[orderId]/route";function y(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:x})}},57771:(e,r,s)=>{s.d(r,{I8:()=>g,handlers:()=>m,w7:()=>p});var t=s(84137),a=s(48842),n=s(9142),i=s(34247),o=s(50173),l=s(91888),u=s.n(l),d=s(61821);let{handlers:m,signIn:c,signOut:p,auth:g}=(0,a.ZP)({secret:process.env.AUTH_SECRET||"default-secret",trustHost:!0,session:{strategy:"jwt"},adapter:(0,t.N)(d.Z),callbacks:{session:({token:e,session:r})=>(e.sub&&r.user&&(r.user.id=e.sub),e.role&&r.user&&(r.user.role=e.role),e.slug&&r.user&&(r.user.slug=e.slug),r),async jwt({token:e}){if(!e.sub)return e;let r=await (0,n.GA)(e.sub);return r&&(e.role=r.role,e.slug=r.slug),e}},providers:[(0,i.Z)({credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){let r=o.pj.safeParse(e);if(r.success){let{email:e,password:s}=r.data,t=await (0,n.CX)(e);if(!t||!t.password)return null;if(await u().compare(s,t.password))return t}return null}})],pages:{signIn:"/login"}})},61821:(e,r,s)=>{s.d(r,{Z:()=>a});var t=s(53524);let a=globalThis.prisma||new t.PrismaClient},50173:(e,r,s)=>{s.d(r,{Po:()=>o,Un:()=>n,o$:()=>i,pj:()=>a});var t=s(48873);let a=t.Ry({email:t.Z_().email({message:"Email inv\xe1lido"}),password:t.Z_().min(2,{message:"M\xednimo 8 caracteres"})});t.Ry({email:t.Z_().email({message:"El email inv\xe1lido"}),password:t.Z_().min(2,{message:"M\xednimo 2 caracteres"}),name:t.Z_().min(1,{message:"El nombre es requerido"}),slug:t.Z_().min(1,{message:"Link es requerido"}).regex(/^\S*$/,"El link no debe contener espacios"),role:t.Km(["USER","ADMIN"]),isActive:t.O7()}),t.Ry({email:t.Z_().email({message:"El email inv\xe1lido"}),name:t.Z_().min(1,{message:"El nombre es requerido"}),role:t.Km(["USER","ADMIN"]),slug:t.Z_().min(1,{message:"Link es requerido"}).regex(/^\S*$/,"El link no debe contener espacios"),isActive:t.O7()});let n=t.Ry({dayOpenTime:t.Z_().min(1,{message:"El horario es requerido"}),dayCloseTime:t.Z_().min(1,{message:"El horario es requerido"}),nightOpenTime:t.Z_().min(1,{message:"El horario es requerido"}),nightCloseTime:t.Z_().min(1,{message:"El horario es requerido"}),image:t.Z_().optional(),location:t.Z_().min(1,"La ubicaci\xf3n es requerida"),phone:t.Z_().min(1,"El tel\xe9fono es requerido"),table:t.O7(),delivery:t.O7(),takeaway:t.O7(),qr:t.O7(),cash:t.O7(),card:t.O7(),transfer:t.O7(),qrImage:t.Z_().optional(),cbu:t.Z_().optional()}).refine(e=>!e.qr||e.qr&&e.qrImage?.length>0,{message:"Si se puede pagar con QR, la imagen del QR es obligatoria",path:["qrImage"]}).refine(e=>!e.transfer||e.transfer&&e.cbu?.length>0,{message:"Si la transferencia est\xe1 habilitada, el CBU es obligatorio",path:["cbu"]}),i=t.Ry({name:t.Z_().min(1,{message:"El nombre es requerido"}).max(50)}),o=t.Ry({name:t.Z_().min(1,{message:"El nombre es requerido"}).max(50),categoryId:t.Z_().min(1,{message:"La categor\xeda es requerida"})});t.Ry({name:t.Z_().min(1,{message:"El nombre es requerido"}).max(50),description:t.Z_().optional(),price:t.oQ.number().min(1,{message:"El precio es requerido"}),image:t.Z_().min(1,{message:"La imagen es requerida"}),subcategoryId:t.Z_().min(1,{message:"La categor\xeda es requerida"}),sizes:t.IX(t.Ry({name:t.Z_().min(1,{message:"El tama\xf1o es requerido"}),price:t.oQ.number().min(1,{message:"El precio es requerido"})})),extras:t.IX(t.Ry({name:t.Z_().min(1,{message:"El extra es requerido"}),price:t.oQ.number().min(1,{message:"El precio es requerido"})})),isPromo:t.O7().optional().default(!1),promoPrice:t.oQ.number().optional(),isArchived:t.O7().optional().default(!1)}).refine(e=>!e.isPromo||e.isPromo&&e.promoPrice&&e.promoPrice>0,{message:"El precio de promo es requerido",path:["promoPrice"]}),t.Ry({name:t.Z_().min(2,{message:"El nombre es requerido"}).max(50),phone:t.Z_().min(2,{message:"El tel\xe9fono es requerido"}).max(10),comment:t.Z_().max(50).optional(),type:t.Km(["DELIVERY","TAKEAWAY","TABLE"]),payment:t.Km(["CASH","CARD","TRANSFER","QR"]).default("CASH"),place:t.Z_().max(50).optional()})},9142:(e,r,s)=>{s.d(r,{CX:()=>a,GA:()=>n,Ne:()=>o,VG:()=>i});var t=s(61821);s(53524),s(76704);let a=async e=>{try{return await t.Z.user.findUnique({where:{email:e}})}catch{return null}},n=async e=>{try{return await t.Z.user.findUnique({where:{id:e}})}catch{return null}},i=async e=>{try{return await t.Z.user.findUnique({where:{slug:e}})}catch{return null}},o=async(e,r)=>!!r&&r.user.slug===e},14609:(e,r,s)=>{e.exports=s(30517)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4974,7795,5295],()=>s(51762));module.exports=t})();